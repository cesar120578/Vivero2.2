<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sistema Vivero ADMIN 2.0 - RDM</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    font-family: Arial;
    background:#000;
    color:#d4af37;
    text-align:center;
}

.logo{
    width:200px;
    margin-top:20px;
    filter: drop-shadow(0 0 8px #d4af37);
}

.container{
    background:#111;
    margin:20px auto;
    padding:20px;
    width:90%;
    max-width:900px;
    border-radius:15px;
    box-shadow:0 0 20px rgba(212,175,55,0.3);
}

input, button, select{
    width:90%;
    padding:10px;
    margin:5px;
    border-radius:8px;
    border:1px solid #d4af37;
    background:#000;
    color:#d4af37;
}

button{
    background:#d4af37;
    color:black;
    font-weight:bold;
    cursor:pointer;
}

button:hover{
    background:#f0c75e;
}

.hidden{ display:none; }

.alerta{ color:red; font-weight:bold; }

canvas{
    margin-top:20px;
    background:#111;
    border-radius:10px;
    padding:10px;
}
</style>
</head>

<body>

<img src="logo.jpg" class="logo">
<h2>üåø Sistema Vivero ADMIN 2.0</h2>

<div class="container" id="loginDiv">
<h3>üîê Iniciar Sesi√≥n</h3>
<input type="text" id="usuario">
<input type="password" id="clave">
<button onclick="login()">Entrar</button>
<p id="errorLogin"></p>
</div>

<div class="container hidden" id="sistema">

<p>Usuario activo: <span id="usuarioActivo"></span></p>
<button onclick="logout()">Cerrar sesi√≥n</button>

<div id="adminPanel">

<hr>
<h3>‚ûï Agregar Planta</h3>
<input type="text" id="nombreNueva" placeholder="Nombre">
<input type="number" id="precioNueva" placeholder="Precio">
<input type="number" id="cantidadNueva" placeholder="Cantidad inicial">
<button onclick="agregarPlanta()">Agregar</button>

<hr>
<h3>üå± Reabastecer</h3>
<select id="reabastecerNombre"></select>
<input type="number" id="cantidadReabastecer" placeholder="Cantidad">
<button onclick="reabastecer()">Reabastecer</button>

</div>

<hr>
<h3>üí∞ Registrar Venta</h3>
<select id="ventaNombre"></select>
<input type="number" id="ventaCantidad" placeholder="Cantidad">

<label>
<input type="checkbox" id="descuentoCheck"> Aplicar descuento
</label>

<div id="descuentoDiv" class="hidden">
<input type="password" id="claveAdminDescuento" placeholder="Clave admin">
<input type="number" id="precioEspecial" placeholder="Nuevo precio">
</div>

<button onclick="registrarVenta()">Registrar</button>

<hr>
<h3>üìä Resumen del D√≠a</h3>
<div id="resumen"></div>

<hr>
<h3>üì¶ Inventario</h3>
<button onclick="toggleInventario()" id="btnInv">Mostrar Inventario</button>
<div id="inventario" class="hidden"></div>

<hr>
<h3>üìà Gr√°ficas</h3>
<button onclick="generarGraficas()">Actualizar Gr√°ficas</button>
<canvas id="graficaDia"></canvas>
<canvas id="graficaPlantas"></canvas>

</div>

<script>

// ===== USUARIOS =====
const admins = ["C√©sar","Oswaldo","Hanalih","Sofia","Valeria"];
const empleados = ["Emp1","Emp2","Emp3"];

const claveAdmin = "ViverosRDM12";
const claveEmpleado = "ViverosRDMempl";

let usuarioActual = null;
let rolActual = null;

let plantas = JSON.parse(localStorage.getItem("plantas")) || {};
let ventas = JSON.parse(localStorage.getItem("ventas")) || [];

function guardar(){
    localStorage.setItem("plantas", JSON.stringify(plantas));
    localStorage.setItem("ventas", JSON.stringify(ventas));
}

// ===== LOGIN =====
function login(){
    let user = usuario.value;
    let pass = clave.value;

    if(admins.includes(user) && pass===claveAdmin){
        rolActual="admin";
    } else if(empleados.includes(user) && pass===claveEmpleado){
        rolActual="empleado";
        document.getElementById("adminPanel").style.display="none";
    } else{
        errorLogin.innerText="Credenciales incorrectas";
        return;
    }

    usuarioActual=user;
    loginDiv.classList.add("hidden");
    sistema.classList.remove("hidden");
    usuarioActivo.innerText=user+" ("+rolActual+")";
    actualizarSelects();
}

// ===== PLANTAS =====
function agregarPlanta(){
    if(rolActual!=="admin") return;

    let nombre=nombreNueva.value.trim();
    let precio=parseFloat(precioNueva.value);
    let cantidad=parseInt(cantidadNueva.value);

    if(!nombre||precio<=0||cantidad<0) return;
    if(plantas[nombre]) return;

    plantas[nombre]={precio, inventario:cantidad, vendidas:0};
    guardar();
    actualizarSelects();
}

function reabastecer(){
    if(rolActual!=="admin") return;

    let nombre=reabastecerNombre.value;
    let cantidad=parseInt(cantidadReabastecer.value);
    if(!plantas[nombre]||cantidad<=0) return;

    plantas[nombre].inventario+=cantidad;
    guardar();
}

// ===== VENTAS =====
document.getElementById("descuentoCheck").addEventListener("change",()=>{
    descuentoDiv.classList.toggle("hidden");
});

function registrarVenta(){
    let nombre=ventaNombre.value;
    let cantidad=parseInt(ventaCantidad.value);
    if(!plantas[nombre]||cantidad<=0) return;
    if(plantas[nombre].inventario<cantidad) return;

    let precio=plantas[nombre].precio;

    if(descuentoCheck.checked && rolActual==="admin"){
        if(claveAdminDescuento.value===claveAdmin && precioEspecial.value>0){
            precio=parseFloat(precioEspecial.value);
        }
    }

    plantas[nombre].inventario-=cantidad;
    plantas[nombre].vendidas+=cantidad;

    ventas.push({
        nombre,
        cantidad,
        precio,
        total:cantidad*precio,
        fecha:new Date().toLocaleString(),
        usuario:usuarioActual
    });

    guardar();
    actualizarResumen();
}

function actualizarResumen(){
    let hoy=new Date().toLocaleDateString();
    let ventasHoy=ventas.filter(v=>new Date(v.fecha).toLocaleDateString()===hoy);
    let total=ventasHoy.reduce((s,v)=>s+v.total,0);
    let cantidad=ventasHoy.reduce((s,v)=>s+v.cantidad,0);

    resumen.innerHTML=`
    Plantas vendidas hoy: ${cantidad}<br>
    Dinero generado hoy: $${total.toFixed(2)}
    `;
}

// ===== INVENTARIO =====
function toggleInventario(){
    inventario.classList.toggle("hidden");
    btnInv.innerText = inventario.classList.contains("hidden")
        ? "Mostrar Inventario"
        : "Ocultar Inventario";

    mostrarInventario();
}

function mostrarInventario(){
    inventario.innerHTML="";
    for(let nombre in plantas){
        let p=plantas[nombre];
        let alerta=p.inventario<=10?"<span class='alerta'>‚ö† Bajo stock</span>":"";
        inventario.innerHTML+=`
        <p><strong>${nombre}</strong><br>
        Precio: $${p.precio}<br>
        Inventario: ${p.inventario} ${alerta}<br>
        Vendidas: ${p.vendidas}</p><hr>
        `;
    }
}

function actualizarSelects(){
    ventaNombre.innerHTML="";
    reabastecerNombre.innerHTML="";
    for(let nombre in plantas){
        ventaNombre.innerHTML+=`<option>${nombre}</option>`;
        reabastecerNombre.innerHTML+=`<option>${nombre}</option>`;
    }
    actualizarResumen();
}

// ===== GR√ÅFICAS =====
let chart1, chart2;

function generarGraficas(){
    let hoy=new Date().toLocaleDateString();
    let ventasHoy=ventas.filter(v=>new Date(v.fecha).toLocaleDateString()===hoy);
    let total=ventasHoy.reduce((s,v)=>s+v.total,0);

    if(chart1) chart1.destroy();
    if(chart2) chart2.destroy();

    chart1=new Chart(graficaDia,{
        type:"bar",
        data:{
            labels:["Ventas Hoy"],
            datasets:[{label:"Total $", data:[total], backgroundColor:"#d4af37"}]
        }
    });

    let resumenPlantas={};
    ventasHoy.forEach(v=>{
        resumenPlantas[v.nombre]=(resumenPlantas[v.nombre]||0)+v.total;
    });

    chart2=new Chart(graficaPlantas,{
        type:"pie",
        data:{
            labels:Object.keys(resumenPlantas),
            datasets:[{data:Object.values(resumenPlantas)}]
        }
    });
}

function logout(){
    location.reload();
}

</script>

</body>
</html>
