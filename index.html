<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Viveros RDM 2.4 PRO</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    background:black;
    color:gold;
    font-family:Arial;
    text-align:center;
}
h2{
    cursor:pointer;
    border-bottom:1px solid gold;
    padding:8px;
}
.section{
    width:85%;
    margin:20px auto;
    border:1px solid gold;
    border-radius:10px;
    padding:15px;
}
.hidden{
    display:none;
}
input,select,button{
    padding:8px;
    margin:5px;
    border-radius:6px;
    border:none;
}
button{
    background:gold;
    color:black;
    font-weight:bold;
    cursor:pointer;
}
table{
    width:100%;
    margin-top:10px;
    border-collapse:collapse;
}
th,td{
    border:1px solid gold;
    padding:6px;
}
</style>
</head>

<body>

<h1>ðŸŒ¿ VIVEROS ROSAS DEL MONTE ðŸŒ¿</h1>

<!-- AGREGAR -->
<div class="section">
<h2 onclick="toggle('agregarDiv')">Agregar Planta</h2>
<div id="agregarDiv" class="hidden">

<input id="nombreNueva" placeholder="Nombre">
<input id="precioNueva" type="number" placeholder="Precio">
<input id="cantidadNueva" type="number" placeholder="Cantidad">
<button onclick="agregarPlanta()">Agregar</button>

<h4>Plantas existentes</h4>
<ul id="listaExistente"></ul>

</div>
</div>

<!-- INVENTARIO -->
<div class="section">
<h2 onclick="toggle('inventarioDiv')">Inventario</h2>
<div id="inventarioDiv" class="hidden">
<ul id="listaInventario"></ul>
</div>
</div>

<!-- VENTAS -->
<div class="section">
<h2 onclick="toggle('ventasDiv')">Registrar Venta</h2>
<div id="ventasDiv" class="hidden">

<select id="ventaNombre"></select>
<input id="ventaCantidad" type="number" placeholder="Cantidad">
<button onclick="registrarVenta()">Vender</button>

</div>
</div>

<!-- REPORTES -->
<div class="section">
<h2 onclick="toggle('reporteDiv')">Reportes / Dashboard</h2>
<div id="reporteDiv" class="hidden">

<h3>Total generado: $<span id="totalDinero">0</span></h3>

<canvas id="graficaVentas"></canvas>

<table>
<thead>
<tr>
<th>Planta</th>
<th>Cantidad</th>
<th>Precio</th>
<th>Total</th>
<th>Fecha</th>
</tr>
</thead>
<tbody id="tablaVentas"></tbody>
</table>

</div>
</div>

<script>

let plantas = JSON.parse(localStorage.getItem("plantas")) || {};
let ventas = JSON.parse(localStorage.getItem("ventas")) || {};
let grafica;

function guardar(){
    localStorage.setItem("plantas",JSON.stringify(plantas));
    localStorage.setItem("ventas",JSON.stringify(ventas));
}

function toggle(id){
    document.getElementById(id).classList.toggle("hidden");
}

function ordenar(){
    return Object.keys(plantas).sort((a,b)=>a.localeCompare(b));
}

function actualizarExistentes(){
    let ul=document.getElementById("listaExistente");
    ul.innerHTML="";
    ordenar().forEach(nombre=>{
        let li=document.createElement("li");
        li.innerText=nombre;
        ul.appendChild(li);
    });
}

function actualizarInventario(){
    let ul=document.getElementById("listaInventario");
    ul.innerHTML="";
    ordenar().forEach(nombre=>{
        let li=document.createElement("li");
        li.innerText=`${nombre} â€” ${plantas[nombre].inventario}`;
        ul.appendChild(li);
    });
}

function actualizarSelect(){
    let select=document.getElementById("ventaNombre");
    select.innerHTML="";
    ordenar().forEach(nombre=>{
        let option=document.createElement("option");
        option.value=nombre;
        option.text=nombre;
        select.appendChild(option);
    });
}

function agregarPlanta(){
    let nombre=document.getElementById("nombreNueva").value.trim();
    let precio=document.getElementById("precioNueva").value;
    let cantidad=document.getElementById("cantidadNueva").value;

    if(!nombre||!precio||!cantidad){ alert("Completa todos los campos"); return; }
    if(plantas[nombre]){ alert("Ya existe"); return;}

    plantas[nombre]={
        precio:parseFloat(precio),
        inventario:parseInt(cantidad)
    };

    guardar();
    actualizarTodo();

    nombreNueva.value="";
    precioNueva.value="";
    cantidadNueva.value="";
}

function registrarVenta(){
    let nombre=document.getElementById("ventaNombre").value;
    let cantidad=parseInt(document.getElementById("ventaCantidad").value);

    if(!cantidad||cantidad<=0){ alert("Cantidad invÃ¡lida"); return;}
    if(plantas[nombre].inventario < cantidad){ alert("Stock insuficiente"); return;}

    plantas[nombre].inventario -= cantidad;

    if(!Array.isArray(ventas)) ventas=[];

    ventas.push({
        nombre,
        cantidad,
        precio:plantas[nombre].precio,
        total:cantidad*plantas[nombre].precio,
        fecha:new Date().toLocaleString()
    });

    guardar();
    actualizarTodo();

    ventaCantidad.value="";
}

function actualizarReportes(){

    let total=0;
    let tabla=document.getElementById("tablaVentas");
    tabla.innerHTML="";

    let conteo={};

    ventas.forEach(v=>{
        total+=v.total;

        let row=document.createElement("tr");
        row.innerHTML=`
        <td>${v.nombre}</td>
        <td>${v.cantidad}</td>
        <td>$${v.precio}</td>
        <td>$${v.total}</td>
        <td>${v.fecha}</td>
        `;
        tabla.appendChild(row);

        if(!conteo[v.nombre]) conteo[v.nombre]=0;
        conteo[v.nombre]+=v.cantidad;
    });

    document.getElementById("totalDinero").innerText=total;

    let labels=Object.keys(conteo);
    let data=Object.values(conteo);

    if(grafica) grafica.destroy();

    let ctx=document.getElementById("graficaVentas").getContext("2d");
    grafica=new Chart(ctx,{
        type:"bar",
        data:{
            labels:labels,
            datasets:[{
                label:"Cantidad Vendida",
                data:data
            }]
        }
    });
}

function actualizarTodo(){
    actualizarExistentes();
    actualizarInventario();
    actualizarSelect();
    actualizarReportes();
}

actualizarTodo();

</script>

</body>
</html>
