<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Viveros RDM 2.9 PRO</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    background:black;
    color:gold;
    font-family:Arial;
    text-align:center;
}

.logo{
    font-size:28px;
    font-weight:bold;
    margin-top:10px;
}

.section{
    width:90%;
    margin:25px auto;
    border:1px solid gold;
    border-radius:10px;
    padding:20px;
}

h2{
    cursor:pointer;
    border-bottom:1px solid gold;
    padding-bottom:8px;
}

.hidden{
    display:none;
}

input,select,button{
    padding:8px;
    margin:6px;
    border-radius:6px;
    border:none;
}

button{
    background:gold;
    color:black;
    font-weight:bold;
    cursor:pointer;
}

button:hover{
    background:#d4af37;
}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:15px;
    font-size:18px;
}

th,td{
    border:1px solid gold;
    padding:10px;
}

th{
    background:#111;
}

canvas{
    margin-top:20px;
}

#loginBox{
    margin-top:100px;
}

.usuarioActivo{
    margin-top:10px;
    font-size:14px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
    <h2>Iniciar Sesi칩n</h2>
    <input id="usuarioInput" placeholder="Usuario">
    <input id="claveInput" type="password" placeholder="Contrase침a">
    <button onclick="login()">Ingresar</button>
</div>

<!-- SISTEMA -->
<div id="sistema" class="hidden">

<div class="logo">游 VIVEROS RDM 游</div>
<div class="usuarioActivo">
Usuario activo: <span id="usuarioActivo"></span>
<button onclick="cerrarSesion()">Cerrar sesi칩n</button>
<button onclick="restablecerSistema()">Restablecer Sistema</button>
</div>

<!-- AGREGAR PLANTA -->
<div class="section">
<h2 onclick="toggle('agregarDiv')">Agregar Planta</h2>
<div id="agregarDiv" class="hidden">

<input id="nombreNueva" placeholder="Nombre de la planta">
<input id="precioNueva" type="number" placeholder="Precio">
<input id="cantidadNueva" type="number" placeholder="Cantidad">
<button onclick="agregarPlanta()">Agregar</button>

</div>
</div>

<!-- REABASTECER -->
<div class="section">
<h2 onclick="toggle('reabastecerDiv')">Reabastecer Inventario</h2>
<div id="reabastecerDiv" class="hidden">

<select id="reabastecerNombre"></select>
<input id="reabastecerCantidad" type="number" placeholder="Cantidad a agregar">
<button onclick="reabastecer()">Reabastecer</button>

</div>
</div>

<!-- EDITAR / ELIMINAR INVENTARIO -->
<div class="section">
<h2 onclick="toggle('editarDiv')">Editar / Eliminar Planta</h2>
<div id="editarDiv" class="hidden">

<select id="editarNombre" onchange="cargarDatosEdicion()"></select>
<br>
<input id="editarNuevoNombre" placeholder="Nuevo nombre">
<input id="editarNuevoPrecio" type="number" placeholder="Nuevo precio">
<input id="editarNuevaCantidad" type="number" placeholder="Nueva cantidad">
<br>
<button onclick="guardarCambios()">Guardar Cambios</button>
<button onclick="eliminarPlanta()">Eliminar Planta</button>

</div>
</div>

<!-- INVENTARIO -->
<div class="section">
<h2 onclick="toggle('inventarioDiv')">Inventario</h2>
<div id="inventarioDiv" class="hidden">

<table>
<thead>
<tr>
<th>Planta</th>
<th>Precio</th>
<th>Stock</th>
</tr>
</thead>
<tbody id="tablaInventario"></tbody>
</table>

</div>
</div>

<!-- VENTAS -->
<div class="section">
<h2 onclick="toggle('ventasDiv')">Registrar Venta</h2>
<div id="ventasDiv" class="hidden">

<select id="ventaNombre"></select>
<input id="ventaCantidad" type="number" placeholder="Cantidad">
<button onclick="registrarVenta()">Vender</button>

</div>
</div>

<!-- REPORTES -->
<div class="section">
<h2 onclick="toggle('reporteDiv')">Reportes / Dashboard</h2>
<div id="reporteDiv" class="hidden">

<h3>Total generado: $<span id="totalDinero">0</span></h3>

<canvas id="graficaVentas"></canvas>

<table>
<thead>
<tr>
<th>Planta</th>
<th>Cantidad</th>
<th>Precio</th>
<th>Total</th>
<th>Fecha</th>
</tr>
</thead>
<tbody id="tablaVentas"></tbody>
</table>

</div>
</div>

</div>

<script>

// USUARIOS
const admins=["C칠sar","Oswaldo","Hanalih","Sofia","Valeria"];
const empleados=["Emp1","Emp2","Emp3"];
const claveAdmin="ViverosRDM12";
const claveEmpleado="ViverosRDMempl";

let usuarioActual="";
let plantas=JSON.parse(localStorage.getItem("plantas"))||{};
let ventas=JSON.parse(localStorage.getItem("ventas"))||[];
let grafica;

// LOGIN
function login(){
    let u=document.getElementById("usuarioInput").value;
    let c=document.getElementById("claveInput").value;

    if(admins.includes(u)&&c===claveAdmin){
        iniciarSistema(u);
    }
    else if(empleados.includes(u)&&c===claveEmpleado){
        iniciarSistema(u);
    }
    else{
        alert("Usuario o contrase침a incorrectos");
    }
}

function iniciarSistema(usuario){
    usuarioActual=usuario;
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("sistema").classList.remove("hidden");
    document.getElementById("usuarioActivo").innerText=usuarioActual;
    actualizarTodo();
}

function cerrarSesion(){
    location.reload();
}

// RESTABLECER
function restablecerSistema(){
    let codigo = prompt("Ingresa el c칩digo de restablecimiento:");
    if(codigo === "241412"){
        let confirmar = confirm("쯉eguro que deseas borrar toda la informaci칩n?");
        if(confirmar){
            plantas = {};
            ventas = [];
            localStorage.removeItem("plantas");
            localStorage.removeItem("ventas");
            actualizarTodo();
            alert("Sistema restablecido correctamente");
        }
    }else{
        alert("C칩digo incorrecto");
    }
}

function guardar(){
    localStorage.setItem("plantas",JSON.stringify(plantas));
    localStorage.setItem("ventas",JSON.stringify(ventas));
}

function toggle(id){
    document.getElementById(id).classList.toggle("hidden");
}

function ordenar(){
    return Object.keys(plantas).sort((a,b)=>a.localeCompare(b));
}

function actualizarInventario(){
    let tabla=document.getElementById("tablaInventario");
    tabla.innerHTML="";
    ordenar().forEach(nombre=>{
        let row=document.createElement("tr");
        row.innerHTML=`
            <td>${nombre}</td>
            <td>$${plantas[nombre].precio}</td>
            <td>${plantas[nombre].inventario}</td>
        `;
        tabla.appendChild(row);
    });
}

function actualizarSelect(){
    let selects=["ventaNombre","reabastecerNombre","editarNombre"];
    selects.forEach(id=>{
        let select=document.getElementById(id);
        select.innerHTML="";
        ordenar().forEach(nombre=>{
            let option=document.createElement("option");
            option.value=nombre;
            option.text=nombre;
            select.appendChild(option);
        });
    });
}

// EDITAR
function cargarDatosEdicion(){
    let nombre=document.getElementById("editarNombre").value;
    document.getElementById("editarNuevoNombre").value=nombre;
    document.getElementById("editarNuevoPrecio").value=plantas[nombre].precio;
    document.getElementById("editarNuevaCantidad").value=plantas[nombre].inventario;
}

function guardarCambios(){
    let nombreActual=document.getElementById("editarNombre").value;
    let nuevoNombre=document.getElementById("editarNuevoNombre").value.trim();
    let nuevoPrecio=parseFloat(document.getElementById("editarNuevoPrecio").value);
    let nuevaCantidad=parseInt(document.getElementById("editarNuevaCantidad").value);

    if(!nuevoNombre||!nuevoPrecio||nuevaCantidad<0){
        alert("Datos inv치lidos");
        return;
    }

    delete plantas[nombreActual];

    plantas[nuevoNombre]={
        precio:nuevoPrecio,
        inventario:nuevaCantidad
    };

    guardar();
    actualizarTodo();
    alert("Cambios guardados");
}

function eliminarPlanta(){
    let nombre=document.getElementById("editarNombre").value;
    let confirmar=confirm("쯉eguro que deseas eliminar esta planta?");
    if(confirmar){
        delete plantas[nombre];
        guardar();
        actualizarTodo();
        alert("Planta eliminada");
    }
}

function agregarPlanta(){
    let nombre=document.getElementById("nombreNueva").value.trim();
    let precio=document.getElementById("precioNueva").value;
    let cantidad=document.getElementById("cantidadNueva").value;

    if(!nombre||!precio||!cantidad){ alert("Completa todos los campos"); return;}
    if(plantas[nombre]){ alert("La planta ya existe"); return;}

    plantas[nombre]={
        precio:parseFloat(precio),
        inventario:parseInt(cantidad)
    };

    guardar();
    actualizarTodo();

    nombreNueva.value="";
    precioNueva.value="";
    cantidadNueva.value="";
}

function reabastecer(){
    let nombre=document.getElementById("reabastecerNombre").value;
    let cantidad=parseInt(document.getElementById("reabastecerCantidad").value);

    if(!cantidad||cantidad<=0){ alert("Cantidad inv치lida"); return;}

    plantas[nombre].inventario += cantidad;

    guardar();
    actualizarTodo();

    reabastecerCantidad.value="";
}

function registrarVenta(){
    let nombre=document.getElementById("ventaNombre").value;
    let cantidad=parseInt(document.getElementById("ventaCantidad").value);

    if(!cantidad||cantidad<=0){ alert("Cantidad inv치lida"); return;}
    if(plantas[nombre].inventario < cantidad){ alert("Stock insuficiente"); return;}

    plantas[nombre].inventario -= cantidad;

    ventas.push({
        nombre,
        cantidad,
        precio:plantas[nombre].precio,
        total:cantidad*plantas[nombre].precio,
        fecha:new Date().toLocaleString(),
        usuario:usuarioActual
    });

    guardar();
    actualizarTodo();

    ventaCantidad.value="";
}

function actualizarReportes(){
    let total=0;
    let tabla=document.getElementById("tablaVentas");
    tabla.innerHTML="";

    let conteo={};

    ventas.forEach(v=>{
        total+=v.total;

        let row=document.createElement("tr");
        row.innerHTML=`
        <td>${v.nombre}</td>
        <td>${v.cantidad}</td>
        <td>$${v.precio}</td>
        <td>$${v.total}</td>
        <td>${v.fecha}</td>
        `;
        tabla.appendChild(row);

        if(!conteo[v.nombre]) conteo[v.nombre]=0;
        conteo[v.nombre]+=v.cantidad;
    });

    document.getElementById("totalDinero").innerText=total;

    let labels=Object.keys(conteo);
    let data=Object.values(conteo);

    if(grafica) grafica.destroy();

    let ctx=document.getElementById("graficaVentas").getContext("2d");
    grafica=new Chart(ctx,{
        type:"bar",
        data:{
            labels:labels,
            datasets:[{
                label:"Cantidad Vendida",
                data:data
            }]
        }
    });
}

function actualizarTodo(){
    actualizarInventario();
    actualizarSelect();
    actualizarReportes();
}

</script>

</body>
</html>
