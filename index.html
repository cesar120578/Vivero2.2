<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Viveros RDM 2.3 PRO</title>

<style>
body{
    background:black;
    color:gold;
    font-family:Arial;
    text-align:center;
}
h2{
    border-bottom:1px solid gold;
    padding-bottom:5px;
}
input,select,button{
    padding:8px;
    margin:5px;
    border-radius:6px;
    border:none;
}
button{
    background:gold;
    color:black;
    font-weight:bold;
    cursor:pointer;
}
button:hover{
    background:#d4af37;
}
.section{
    margin:20px auto;
    width:80%;
    border:1px solid gold;
    padding:15px;
    border-radius:10px;
}
.hidden{
    display:none;
}
ul{
    list-style:none;
    padding:0;
}
li{
    margin:3px 0;
}
.mensaje{
    margin-top:10px;
    font-weight:bold;
}
.error{ color:red; }
.exito{ color:lime; }
</style>
</head>

<body>

<h1>ðŸŒ¿ VIVEROS RDM 2.3 PRO ðŸŒ¿</h1>

<div class="mensaje" id="mensaje"></div>

<!-- AGREGAR PLANTA -->
<div class="section">
<h2>Agregar Planta</h2>
<button onclick="toggle('agregarDiv')">Mostrar / Ocultar</button>

<div id="agregarDiv" class="hidden">

<input id="nombreNueva" placeholder="Nombre">
<input id="precioNueva" type="number" placeholder="Precio">
<input id="cantidadNueva" type="number" placeholder="Cantidad">
<button onclick="agregarPlanta()">Agregar</button>

<h4>Plantas existentes</h4>
<ul id="listaExistente"></ul>

</div>
</div>

<!-- INVENTARIO -->
<div class="section">
<h2>Inventario</h2>
<button onclick="toggle('inventarioDiv')">Mostrar / Ocultar</button>
<div id="inventarioDiv" class="hidden">
<ul id="listaInventario"></ul>
</div>
</div>

<!-- VENTAS -->
<div class="section">
<h2>Ventas</h2>
<button onclick="toggle('ventasDiv')">Mostrar / Ocultar</button>

<div id="ventasDiv" class="hidden">

<input id="buscarVenta" placeholder="Buscar planta..." onkeyup="filtrarPlantas()">

<select id="ventaNombre"></select>
<input id="ventaCantidad" type="number" placeholder="Cantidad">
<button onclick="registrarVenta()">Registrar Venta</button>

<ul id="listaVentas"></ul>

</div>
</div>

<!-- REPORTES -->
<div class="section">
<h2>Reportes / Dashboard</h2>
<button onclick="toggle('reporteDiv')">Mostrar / Ocultar</button>

<div id="reporteDiv" class="hidden">
<h3>Total generado: $<span id="totalDinero">0</span></h3>
<ul id="desgloseVentas"></ul>
</div>
</div>

<script>

let plantas = JSON.parse(localStorage.getItem("plantas")) || {};
let ventas = JSON.parse(localStorage.getItem("ventas")) || [];

function guardar(){
    localStorage.setItem("plantas",JSON.stringify(plantas));
    localStorage.setItem("ventas",JSON.stringify(ventas));
}

function mostrarMensaje(texto,tipo){
    let m = document.getElementById("mensaje");
    m.innerText = texto;
    m.className = "mensaje " + tipo;
    setTimeout(()=>{m.innerText="";},3000);
}

function toggle(id){
    document.getElementById(id).classList.toggle("hidden");
}

function ordenarAlfabetico(obj){
    return Object.keys(obj).sort((a,b)=>a.localeCompare(b));
}

function actualizarListaExistente(){
    let ul = document.getElementById("listaExistente");
    ul.innerHTML="";
    ordenarAlfabetico(plantas).forEach(nombre=>{
        let li=document.createElement("li");
        li.innerText=nombre;
        ul.appendChild(li);
    });
}

function actualizarInventario(){
    let ul=document.getElementById("listaInventario");
    ul.innerHTML="";
    ordenarAlfabetico(plantas).forEach(nombre=>{
        let li=document.createElement("li");
        li.innerText=`${nombre} - Stock: ${plantas[nombre].inventario} - Precio: $${plantas[nombre].precio}`;
        ul.appendChild(li);
    });
}

function actualizarSelect(){
    let select=document.getElementById("ventaNombre");
    select.innerHTML="";
    ordenarAlfabetico(plantas).forEach(nombre=>{
        let option=document.createElement("option");
        option.value=nombre;
        option.text=nombre;
        select.appendChild(option);
    });
}

function agregarPlanta(){
    let nombre=document.getElementById("nombreNueva").value.trim();
    let precio=document.getElementById("precioNueva").value;
    let cantidad=document.getElementById("cantidadNueva").value;

    if(nombre===""){ mostrarMensaje("Ingresa el nombre","error"); return;}
    if(precio===""){ mostrarMensaje("Ingresa el precio","error"); return;}
    if(cantidad===""){ mostrarMensaje("Ingresa la cantidad","error"); return;}

    if(plantas[nombre]){
        mostrarMensaje("Esa planta ya existe","error");
        return;
    }

    plantas[nombre]={
        precio:parseFloat(precio),
        inventario:parseInt(cantidad)
    };

    guardar();
    actualizarTodo();

    document.getElementById("nombreNueva").value="";
    document.getElementById("precioNueva").value="";
    document.getElementById("cantidadNueva").value="";

    mostrarMensaje("Planta agregada correctamente","exito");
}

function registrarVenta(){
    let nombre=document.getElementById("ventaNombre").value;
    let cantidad=document.getElementById("ventaCantidad").value;

    if(cantidad===""){ mostrarMensaje("Ingresa la cantidad","error"); return;}
    cantidad=parseInt(cantidad);

    if(plantas[nombre].inventario < cantidad){
        mostrarMensaje("No hay suficiente stock","error");
        return;
    }

    plantas[nombre].inventario-=cantidad;

    ventas.push({
        nombre,
        cantidad,
        precio:plantas[nombre].precio,
        total:cantidad*plantas[nombre].precio,
        fecha:new Date().toLocaleString()
    });

    guardar();
    actualizarTodo();

    document.getElementById("ventaCantidad").value="";
    document.getElementById("buscarVenta").value="";

    mostrarMensaje("Venta registrada","exito");
}

function filtrarPlantas(){
    let texto=document.getElementById("buscarVenta").value.toLowerCase();
    let select=document.getElementById("ventaNombre");
    select.innerHTML="";
    ordenarAlfabetico(plantas).forEach(nombre=>{
        if(nombre.toLowerCase().includes(texto)){
            let option=document.createElement("option");
            option.value=nombre;
            option.text=nombre;
            select.appendChild(option);
        }
    });
}

function actualizarReportes(){
    let total=0;
    let ul=document.getElementById("desgloseVentas");
    ul.innerHTML="";

    ventas.forEach(v=>{
        total+=v.total;
        let li=document.createElement("li");
        li.innerText=`${v.nombre} - ${v.cantidad} - $${v.precio} - Total: $${v.total}`;
        ul.appendChild(li);
    });

    document.getElementById("totalDinero").innerText=total;
}

function actualizarTodo(){
    actualizarListaExistente();
    actualizarInventario();
    actualizarSelect();
    actualizarReportes();
}

actualizarTodo();

</script>

</body>
</html>
